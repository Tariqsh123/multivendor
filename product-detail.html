<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Product Details - GlobalMart</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Professional Daraz-like Premium Styles */
        :root {
            --primary: #ff8c33;
            --primary-dark: #e67a22;
            --secondary: #ffb916;
            --success: #00a650;
            --text-dark: #212121;
            --text-light: #757575;
            --border: #f0f0f0;
            --bg-light: #f5f5f5;
            --white: #ffffff;
            --shadow: 0 2px 8px rgba(0,0,0,0.08);
            --shadow-hover: 0 5px 15px rgba(255,140,51,0.15);
        }

        .product-detail-container {
            flex: 1;
            padding: 15px 0 30px;
            max-width: 1280px;
            margin: 0 auto;
            width: 100%;
        }

        .container {
            width: 100%;
            padding: 0 15px;
            margin: 0 auto;
        }

        /* Breadcrumb */
        .breadcrumb {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 6px;
            padding: 10px 0 15px;
            color: var(--text-light);
            font-size: 12px;
        }

        .breadcrumb a {
            color: var(--primary);
            text-decoration: none;
            transition: color 0.2s;
        }

        .breadcrumb a:hover {
            color: var(--primary-dark);
        }

        .breadcrumb i {
            font-size: 10px;
            color: #9e9e9e;
        }

        /* Loading Spinner */
        .loading {
            text-align: center;
            padding: 60px 20px;
            background: var(--white);
            border-radius: 12px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Product Detail Grid */
        .product-detail {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 20px;
            background: var(--white);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            transition: box-shadow 0.3s;
        }

        .product-detail:hover {
            box-shadow: var(--shadow-hover);
        }

        /* Product Images */
        .product-images {
            position: sticky;
            top: 80px;
        }

        .main-image-container {
            width: 100%;
            height: 400px;
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 15px;
            cursor: zoom-in;
            background: var(--white);
            position: relative;
        }

        .main-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            transition: transform 0.3s;
        }

        .main-image:hover {
            transform: scale(1.05);
        }

        .image-thumbnails {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .thumbnail {
            width: 70px;
            height: 70px;
            border: 2px solid transparent;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            padding: 3px;
            background: var(--white);
            transition: all 0.2s;
        }

        .thumbnail:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .thumbnail.active {
            border-color: var(--primary);
        }

        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        /* Product Info */
        .product-info-detail {
            padding-right: 5px;
        }

        .product-info-detail h1 {
            font-size: 22px;
            font-weight: 500;
            color: var(--text-dark);
            line-height: 1.4;
            margin-bottom: 12px;
        }

        /* Store Info */
        .store-info {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 16px 0;
            border-top: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
            background: linear-gradient(to right, #fff8f3, var(--white));
            border-radius: 8px;
            padding: 15px;
        }

        .store-avatar {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid var(--primary);
            cursor: pointer;
            transition: transform 0.3s;
            flex-shrink: 0;
        }

        .store-avatar:hover {
            transform: scale(1.1);
        }

        .store-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .store-details {
            flex: 1;
            min-width: 0;
        }

        .store-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--primary-dark);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 6px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .store-name:hover {
            color: var(--primary);
        }

        .store-name i {
            color: var(--success);
            font-size: 14px;
        }

        .store-meta {
            display: flex;
            gap: 20px;
            color: var(--text-light);
            font-size: 12px;
            flex-wrap: wrap;
        }

        .store-meta span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .store-meta i {
            color: var(--primary);
        }

        .chat-btn {
            padding: 8px 20px;
            background: var(--bg-light);
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            color: #555;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .chat-btn:hover {
            background: #e8e8e8;
            border-color: #ccc;
        }

        /* Rating Section */
        .product-rating {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 0;
            flex-wrap: wrap;
        }

        .rating-stars {
            display: flex;
            align-items: center;
            gap: 2px;
            color: #faca51;
            font-size: 16px;
        }

        .rating-score {
            font-size: 16px;
            font-weight: 600;
            color: var(--primary);
        }

        .rating-count {
            color: var(--text-light);
            font-size: 14px;
        }

        .verified-badge {
            color: #1a9cb7;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 5px;
            background: #e8f0fe;
            padding: 4px 12px;
            border-radius: 20px;
        }

        .verified-badge i {
            color: #1a9cb7;
        }

        /* Price Section */
        .product-price-detail {
            padding: 15px 0;
            border-top: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
        }

        .current-price {
            font-size: 32px;
            font-weight: 600;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .original-price {
            font-size: 16px;
            color: #9e9e9e;
            text-decoration: line-through;
            font-weight: normal;
        }

        .discount {
            background: #fceae8;
            color: var(--primary);
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
        }

        .tax-info {
            font-size: 13px;
            color: var(--text-light);
            margin-top: 5px;
        }

        /* Product Actions */
        .product-actions {
            padding: 20px 0;
        }

        .quantity-selector {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .quantity-label {
            color: var(--text-light);
            font-size: 14px;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
        }

        .quantity-controls button {
            width: 36px;
            height: 36px;
            border: none;
            background: var(--white);
            font-size: 16px;
            cursor: pointer;
            color: #555;
            transition: background 0.2s;
        }

        .quantity-controls button:hover {
            background: var(--bg-light);
        }

        .quantity-controls input {
            width: 60px;
            height: 36px;
            border: none;
            border-left: 1px solid #e0e0e0;
            border-right: 1px solid #e0e0e0;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-cart {
            flex: 2;
            min-width: 180px;
            padding: 14px 20px;
            background: var(--primary);
            color: var(--white);
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn-cart:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,140,51,0.3);
        }

        .btn-buy {
            flex: 1;
            min-width: 140px;
            padding: 14px 20px;
            background: var(--secondary);
            color: var(--text-dark);
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn-buy:hover {
            background: #f5a800;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,185,22,0.3);
        }

        .btn-wishlist {
            width: 52px;
            height: 52px;
            border: 1px solid #e0e0e0;
            background: var(--white);
            border-radius: 8px;
            cursor: pointer;
            font-size: 22px;
            color: #757575;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-wishlist.active {
            background: #fff0f0;
            border-color: #ff4757;
            color: #ff4757;
        }

        .btn-wishlist:hover {
            border-color: var(--primary);
            color: var(--primary);
            transform: scale(1.1);
        }

        /* Delivery Info */
        .delivery-info {
            background: #fafafa;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
        }

        .delivery-item {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .delivery-item:last-child {
            margin-bottom: 0;
        }

        .delivery-item i {
            width: 24px;
            color: var(--primary);
            font-size: 20px;
        }

        .delivery-text {
            flex: 1;
        }

        .delivery-title {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 4px;
            font-size: 14px;
        }

        .delivery-desc {
            color: var(--text-light);
            font-size: 13px;
            line-height: 1.4;
        }

        /* Product Meta */
        .product-meta {
            background: #fafafa;
            border-radius: 12px;
            padding: 20px;
        }

        .meta-row {
            display: flex;
            padding: 10px 0;
            font-size: 14px;
            border-bottom: 1px dashed #e0e0e0;
        }

        .meta-row:last-child {
            border-bottom: none;
        }

        .meta-label {
            width: 110px;
            color: var(--text-light);
            flex-shrink: 0;
        }

        .meta-value {
            flex: 1;
            color: var(--text-dark);
        }

        .meta-value a {
            color: #1a9cb7;
            text-decoration: none;
        }

        .meta-value a:hover {
            color: var(--primary);
        }

        .stock-status {
            color: var(--success);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .stock-status i {
            font-size: 14px;
        }

        /* Reviews Section */
        .reviews-section {
            background: var(--white);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .reviews-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
            gap: 15px;
        }

        .reviews-header h2 {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .reviews-header h2 span {
            background: #f0f0f0;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 14px;
            color: #555;
            font-weight: normal;
        }

        .rating-summary {
            display: flex;
            align-items: center;
            gap: 40px;
            background: #fafafa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .average-rating {
            text-align: center;
            min-width: 140px;
        }

        .big-rating {
            font-size: 48px;
            font-weight: 700;
            color: var(--primary);
            line-height: 1;
        }

        .rating-stars-large {
            color: #faca51;
            margin: 8px 0;
            font-size: 18px;
        }

        .rating-total {
            color: var(--text-light);
            font-size: 13px;
        }

        .rating-bars {
            flex: 1;
            min-width: 250px;
        }

        .rating-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .rating-row .stars {
            width: 60px;
            color: #faca51;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .rating-row .bar {
            flex: 1;
            height: 8px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .rating-row .fill {
            height: 100%;
            background: linear-gradient(90deg, #faca51, #ffb116);
            border-radius: 10px;
            transition: width 0.5s;
        }

        .rating-row .percent {
            width: 45px;
            color: var(--text-light);
            font-size: 13px;
        }

        /* Write Review Button */
        .write-review-btn {
            padding: 12px 25px;
            background: var(--primary);
            color: var(--white);
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .write-review-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,140,51,0.3);
        }

        /* Write Review Form */
        .write-review-form {
            background: #fafafa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            display: none;
            border: 1px solid var(--border);
        }

        .write-review-form.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .form-header h3 {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .close-form {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--text-light);
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .close-form:hover {
            background: #e0e0e0;
            color: var(--text-dark);
        }

        .rating-input {
            margin-bottom: 20px;
        }

        .rating-input label {
            display: block;
            font-size: 14px;
            color: var(--text-dark);
            margin-bottom: 10px;
            font-weight: 500;
        }

        .star-rating-input {
            display: flex;
            gap: 8px;
            font-size: 28px;
            color: #faca51;
        }

        .star-rating-input i {
            cursor: pointer;
            transition: all 0.2s;
        }

        .star-rating-input i:hover {
            transform: scale(1.2);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            color: var(--text-dark);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255,140,51,0.1);
        }

        .form-group textarea {
            height: 120px;
            resize: vertical;
        }

        .image-upload {
            border: 2px dashed #e0e0e0;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: var(--white);
        }

        .image-upload:hover {
            border-color: var(--primary);
            background: #fff8f3;
        }

        .image-upload i {
            font-size: 32px;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .image-upload p {
            color: var(--text-light);
            font-size: 13px;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 25px;
        }

        .btn-submit {
            padding: 12px 30px;
            background: var(--primary);
            color: var(--white);
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-submit:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,140,51,0.3);
        }

        .btn-cancel {
            padding: 12px 30px;
            background: var(--white);
            color: var(--text-light);
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-cancel:hover {
            background: #f5f5f5;
            color: var(--text-dark);
        }

        /* Reviews List */
        .reviews-list {
            margin-top: 20px;
        }

        .review-item {
            padding: 25px 0;
            border-bottom: 1px solid var(--border);
            animation: fadeIn 0.5s;
        }

        .review-item:last-child {
            border-bottom: none;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .reviewer-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .reviewer-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            overflow: hidden;
            background: #f0f0f0;
            border: 2px solid var(--primary);
            flex-shrink: 0;
        }

        .reviewer-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .reviewer-details h4 {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .reviewer-details .stars {
            color: #faca51;
            font-size: 13px;
            display: flex;
            gap: 2px;
        }

        .review-date {
            color: #9e9e9e;
            font-size: 12px;
            background: #f5f5f5;
            padding: 5px 12px;
            border-radius: 20px;
            height: fit-content;
        }

        .review-content {
            padding-left: 63px;
        }

        .review-content h4 {
            font-size: 16px;
            color: var(--text-dark);
            margin-bottom: 8px;
            font-weight: 600;
        }

        .review-content p {
            color: #424242;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .review-images {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .review-image {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            border: 1px solid var(--border);
            transition: all 0.2s;
        }

        .review-image:hover {
            transform: scale(1.05);
            border-color: var(--primary);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .review-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .review-footer {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            padding-left: 63px;
            flex-wrap: wrap;
        }

        .review-footer button {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 13px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s;
            padding: 5px 10px;
            border-radius: 20px;
        }

        .review-footer button:hover {
            color: var(--primary);
            background: #fff0e6;
        }

        /* No Reviews */
        .no-reviews {
            text-align: center;
            padding: 50px 20px;
        }

        .no-reviews i {
            font-size: 60px;
            color: #e0e0e0;
            margin-bottom: 20px;
        }

        .no-reviews p {
            color: var(--text-light);
            font-size: 15px;
            margin-bottom: 25px;
        }

        .no-reviews .write-review-btn {
            display: inline-flex;
            margin: 0 auto;
        }

        /* Load More */
        .load-more {
            text-align: center;
            margin-top: 30px;
        }

        .load-more-btn {
            padding: 12px 35px;
            background: var(--white);
            border: 2px solid var(--primary);
            color: var(--primary);
            border-radius: 40px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .load-more-btn:hover {
            background: var(--primary);
            color: var(--white);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,140,51,0.3);
        }

        .load-more-btn i {
            font-size: 14px;
        }

        /* Related Products */
        .related-products {
            background: var(--white);
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .related-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
            gap: 15px;
        }

        .related-header h2 {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .related-header h2 i {
            color: var(--primary);
        }

        .shuffle-btn {
            padding: 8px 20px;
            background: var(--bg-light);
            border: 1px solid #e0e0e0;
            border-radius: 30px;
            color: #555;
            font-size: 13px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .shuffle-btn:hover {
            background: var(--primary);
            color: var(--white);
            border-color: var(--primary);
        }

        .shuffle-btn i {
            font-size: 14px;
        }

        .related-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        /* HOME PAGE PRODUCT CARD STYLE - Exactly matching your home page */
        .product-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
            transition: 0.3s;
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(255,140,51,0.15);
        }

        .product-image {
            position: relative;
            height: 180px;
            overflow: hidden;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: 0.5s;
        }

        .product-card:hover .product-image img {
            transform: scale(1.1);
        }

        .product-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            z-index: 2;
        }

        .product-wishlist {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 35px;
            height: 35px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 2;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: 0.3s;
        }

        .product-wishlist:hover {
            background: var(--primary);
        }

        .product-wishlist i {
            font-size: 18px;
            color: var(--primary);
        }

        .product-wishlist:hover i {
            color: white;
        }

        .product-wishlist.active {
            background: #fff0f0;
        }

        .product-wishlist.active i {
            color: #ff4757;
        }

        .product-info {
            padding: 15px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .product-category {
            font-size: 12px;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }

        .product-title {
            font-size: 15px;
            font-weight: 500;
            margin-bottom: 8px;
            color: #333;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            min-height: 42px;
        }

        .product-store {
            font-size: 12px;
            color: #757575;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .product-store i {
            color: var(--primary);
            font-size: 10px;
        }

        .product-rating {
            display: flex;
            align-items: center;
            gap: 4px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }

        .product-stars {
            color: #faca51;
            font-size: 12px;
            display: flex;
            gap: 2px;
        }

        .product-reviews {
            font-size: 11px;
            color: #757575;
        }

        .product-desc {
            font-size: 12px;
            color: #757575;
            margin-bottom: 10px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: 1.4;
        }

        .product-price {
            display: flex;
            align-items: baseline;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .product-current {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
        }

        .product-original {
            font-size: 13px;
            color: #999;
            text-decoration: line-through;
        }

        .commission-badge {
            background: #e8f0fe;
            color: #1a9cb7;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            margin-bottom: 8px;
            display: inline-block;
            width: fit-content;
        }

        .product-buttons {
            display: flex;
            gap: 8px;
            margin-top: auto;
        }

        .btn-small {
            flex: 1;
            padding: 8px 0;
            font-size: 12px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-small.add-to-cart {
            background: var(--primary);
            color: white;
            border: none;
        }

        .btn-small.add-to-cart:hover {
            background: var(--primary-dark);
        }

        .btn-small.view-details {
            background: #f5f5f5;
            color: #333;
            text-decoration: none;
            border: 1px solid #e0e0e0;
        }

        .btn-small.view-details:hover {
            background: #e8e8e8;
        }

        /* Wishlist Sidebar */
        .wishlist-sidebar {
            position: fixed;
            right: -100%;
            top: 0;
            width: 100%;
            max-width: 400px;
            height: 100%;
            background: white;
            z-index: 1100;
            transition: 0.3s;
            box-shadow: -4px 0 20px rgba(0,0,0,0.15);
            padding: 20px;
            overflow-y: auto;
        }
        
        .wishlist-sidebar.active {
            right: 0;
        }
        
        .wishlist-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            z-index: 1099;
        }
        
        .wishlist-overlay.active {
            display: block;
        }

        .wishlist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .wishlist-header h3 {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-wishlist {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #777;
        }

        .empty-wishlist {
            text-align: center;
            padding: 40px 20px;
            color: #777;
        }

        .empty-wishlist i {
            font-size: 48px;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .wishlist-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 8px;
            margin-bottom: 10px;
            background: white;
        }

        .wishlist-item img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
        }

        .wishlist-item-info {
            flex: 1;
        }

        .wishlist-item-title {
            font-size: 14px;
            font-weight: 600;
            margin: 0 0 5px 0;
        }

        .wishlist-item-price {
            color: var(--primary);
            font-weight: bold;
            margin-bottom: 5px;
        }

        .wishlist-item-store {
            font-size: 12px;
            color: #666;
        }

        .wishlist-item-remove {
            background: none;
            border: none;
            color: #ff4757;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 5px;
        }

        .wishlist-item-remove:hover {
            color: #ff0000;
        }

        .wishlist-item-add-cart {
            padding: 5px 10px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            margin-top: 5px;
        }

        .wishlist-item-add-cart:hover {
            background: var(--primary-dark);
        }

        /* Mobile Bottom Navigation Bar */
        .mobile-bottom-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
            z-index: 9999;
            padding: 10px 0;
            border-top: 1px solid #eee;
        }

        .mobile-bottom-nav .nav-items {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .mobile-bottom-nav .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #777;
            font-size: 12px;
            transition: 0.3s;
            position: relative;
        }

        .mobile-bottom-nav .nav-item i {
            font-size: 22px;
            margin-bottom: 4px;
        }

        .mobile-bottom-nav .nav-item.active {
            color: var(--primary);
        }

        .mobile-bottom-nav .nav-item .badge {
            position: absolute;
            top: -5px;
            right: -8px;
            background: var(--primary);
            color: white;
            font-size: 10px;
            min-width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
        }

        .mobile-bottom-nav .nav-item-wrapper {
            position: relative;
        }

        /* Cart Sidebar */
        .cart-sidebar {
            position: fixed;
            right: -100%;
            top: 0;
            width: 100%;
            max-width: 400px;
            height: 100%;
            background: white;
            z-index: 1100;
            transition: 0.3s;
            box-shadow: -4px 0 20px rgba(0,0,0,0.15);
            padding: 20px;
            overflow-y: auto;
        }
        
        .cart-sidebar.active {
            right: 0;
        }
        
        .cart-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            z-index: 1099;
        }
        
        .cart-overlay.active {
            display: block;
        }

        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .close-cart {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #777;
        }

        .empty-cart {
            text-align: center;
            padding: 40px 20px;
            color: #777;
        }

        .empty-cart i {
            font-size: 48px;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .cart-footer {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }

        .cart-total {
            display: flex;
            justify-content: space-between;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .btn-block {
            width: 100%;
            padding: 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-block:hover {
            background: var(--primary-dark);
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: white;
            color: var(--text-dark);
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            z-index: 10000;
            animation: slideIn 0.3s;
            border-left: 4px solid var(--primary);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toast i {
            color: var(--primary);
            font-size: 18px;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--white);
            color: var(--text-dark);
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            z-index: 10000;
            animation: slideIn 0.3s;
            border-left: 4px solid var(--primary);
            font-weight: 500;
            max-width: 350px;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .product-detail {
                grid-template-columns: 350px 1fr;
            }
            
            .related-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 900px) {
            .related-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .hamburger {
                display: none !important;
            }
            
            .nav-menu {
                display: none !important;
            }
            
            body {
                padding-bottom: 70px;
            }
            
            .mobile-bottom-nav {
                display: block;
            }
            
            .mobile-cart-floating-button,
            .mobile-wishlist-floating-button {
                display: none !important;
            }
            
            .product-detail {
                grid-template-columns: 1fr;
                padding: 15px;
            }
            
            .product-images {
                position: static;
            }
            
            .main-image-container {
                height: 350px;
            }
            
            .rating-summary {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
            }
            
            .average-rating {
                display: flex;
                align-items: center;
                gap: 20px;
                text-align: left;
                width: 100%;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn-cart, .btn-buy, .btn-wishlist {
                width: 100%;
            }
            
            .store-info {
                flex-wrap: wrap;
            }
            
            .chat-btn {
                width: 100%;
            }
            
            .review-content,
            .review-footer {
                padding-left: 0;
            }
            
            .review-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .related-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .breadcrumb {
                font-size: 11px;
            }
            
            .toast {
                left: 20px;
                right: 20px;
                bottom: 80px;
            }
        }

        @media (max-width: 480px) {
            .product-detail {
                padding: 12px;
            }
            
            .main-image-container {
                height: 280px;
            }
            
            .thumbnail {
                width: 55px;
                height: 55px;
            }
            
            .current-price {
                font-size: 26px;
            }
            
            .store-meta {
                gap: 12px;
            }
            
            .reviews-section,
            .related-products {
                padding: 18px;
            }
            
            .rating-summary {
                padding: 15px;
            }
            
            .average-rating {
                flex-direction: column;
                gap: 5px;
            }
            
            .big-rating {
                font-size: 40px;
            }
            
            .related-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .btn-submit,
            .btn-cancel {
                width: 100%;
            }
            
            .star-rating-input {
                font-size: 24px;
            }
            
            .review-footer {
                gap: 10px;
            }
            
            .review-footer button {
                padding: 5px 8px;
                font-size: 12px;
            }
            
            .notification {
                left: 20px;
                right: 20px;
                max-width: none;
            }
            
            .product-image {
                height: 160px;
            }
            
            .product-title {
                font-size: 14px;
                min-height: 40px;
            }
        }

        @media (max-width: 360px) {
            .thumbnail {
                width: 45px;
                height: 45px;
            }
            
            .store-meta {
                flex-direction: column;
                gap: 5px;
            }
            
            .product-rating {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .verified-badge {
                align-self: flex-start;
            }
        }

        /* Touch Optimizations */
        @media (hover: none) and (pointer: coarse) {
            .btn-cart:hover,
            .btn-buy:hover,
            .btn-wishlist:hover,
            .write-review-btn:hover,
            .load-more-btn:hover,
            .btn-small:hover,
            .product-card:hover {
                transform: none;
            }
            
            .thumbnail:hover {
                transform: none;
            }
            
            .store-avatar:hover {
                transform: none;
            }
        }

        /* Print Styles */
        @media print {
            .product-actions,
            .write-review-btn,
            .chat-btn,
            .btn-wishlist,
            .btn-small,
            .load-more-btn,
            .shuffle-btn,
            .mobile-bottom-nav,
            .wishlist-sidebar,
            .cart-sidebar {
                display: none !important;
            }
            
            .product-detail {
                box-shadow: none;
                border: 1px solid #ccc;
            }
            
            body {
                padding-bottom: 0;
            }
        }

        .hamburger {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container nav-container">
            <a href="index.html" class="logo"><img src="assets/logo.png" id="logo" alt=""></a>
            
            <div class="nav-menu" id="navMenu">
                <a href="index.html" class="nav-link">Home</a>
                <a href="about.html" class="nav-link">About</a>
                <a href="products.html" class="nav-link">Products</a>
                <a href="research-hub.html" class="nav-link">Research Hub</a>
                <a href="faq.html" class="nav-link">FAQs</a>
                <a href="account.html" class="nav-link">Account</a>
                <a href="dashboard.html" class="nav-link dashboard-link" style="display:none;">Dashboard</a>

                <div id="wish-and-cart-menu">
                    <a href="#" class="nav-link wishlist-icon" id="wishlistIcon">
                        <i class="fas fa-heart"></i>
                        <span class="wishlist-count">0</span>
                    </a>
                    <a href="#" class="nav-link cart-icon" id="cartIcon">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-count">0</span>
                    </a>
                </div>
            </div>
            
            <button class="hamburger" id="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <!-- Mobile Floating Buttons -->
    <div class="mobile-cart-floating-button">
        <i class="fas fa-shopping-cart"></i>
        <span class="cart-count">0</span>
    </div>

    <div class="mobile-wishlist-floating-button">
        <i class="fas fa-heart"></i>
        <span class="wishlist-count">0</span>
    </div>

    <!-- Product Detail -->
    <section class="product-detail-container">
        <div class="container">
            <!-- Breadcrumb -->
            <div class="breadcrumb">
                <a href="index.html">Home</a>
                <i class="fas fa-chevron-right"></i>
                <a href="products.html">Products</a>
                <i class="fas fa-chevron-right"></i>
                <span id="productCategory">Electronics</span>
                <i class="fas fa-chevron-right"></i>
                <span id="productName">Product Details</span>
            </div>

            <div id="productDetailContent">
                <!-- Product will be loaded here -->
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading product details...</p>
                </div>
            </div>
            
            <!-- Reviews Section -->
            <div id="reviewsSection"></div>
            
            <!-- Related Products Section -->
            <div id="relatedProductsSection"></div>
            
            <div class="text-center" style="margin-top: 20px; text-align: center;">
                <a href="products.html" class="btn btn-outline" style="padding: 8px 20px; border-radius: 30px; display: inline-block; background: white; border: 1px solid var(--primary); color: var(--primary); text-decoration: none;">
                    <i class="fas fa-arrow-left"></i> Back to Products
                </a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <h3>GlobalMart</h3>
                    <p>Multi-vendor B2B and B2C marketplace connecting China to the world.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="products.html">Products</a></li>
                        <li><a href="research-hub.html">Research Hub</a></li>
                        <li><a href="account.html">Account</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Support</h4>
                    <ul>
                        <li><a href="faq.html">FAQ</a></li>
                        <li><a href="shipping-policy.html">Shipping Policy</a></li>
                        <li><a href="return-policy.html">Return Policy</a></li>
                        <li><a href="contact-us.html">Contact Us</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Contact Info</h4>
                    <ul class="contact-info">
                        <li><i class="fas fa-map-marker-alt"></i> 123 Business Ave, Shanghai, China</li>
                        <li><i class="fas fa-phone"></i> +86 123 456 7890</li>
                        <li><i class="fas fa-envelope"></i> info@globalmart.com</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 GlobalMart. All rights reserved. | Designed for Educational Purposes</p>
            </div>
        </div>
    </footer>

    <!-- Cart Sidebar -->
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <h3>Your Cart</h3>
            <button class="close-cart" id="closeCart">&times;</button>
        </div>
        <div class="cart-items" id="cartItems">
            <div class="empty-cart">
                <i class="fas fa-shopping-cart"></i>
                <p>Your cart is empty</p>
            </div>
        </div>
        <div class="cart-footer">
            <div class="cart-total">
                <span>Total:</span>
                <span class="total-price">Rs 0</span>
            </div>
            <button class="btn btn-primary btn-block" id="checkoutBtn">Proceed to Checkout</button>
        </div>
    </div>
    <div class="cart-overlay" id="cartOverlay"></div>

    <!-- Wishlist Sidebar -->
    <div class="wishlist-sidebar" id="wishlistSidebar">
        <div class="wishlist-header">
            <h3>Your Wishlist <i class="fas fa-heart" style="color: #ff4757;"></i></h3>
            <button class="close-wishlist" id="closeWishlist">&times;</button>
        </div>
        <div class="wishlist-items" id="wishlistItems">
            <div class="empty-wishlist">
                <i class="fas fa-heart"></i>
                <p>Your wishlist is empty</p>
                <small>Click the heart icon on products to add them here</small>
            </div>
        </div>
    </div>
    <div class="wishlist-overlay" id="wishlistOverlay"></div>

    <!-- MOBILE BOTTOM NAVIGATION BAR -->
    <div class="mobile-bottom-nav">
        <div class="nav-items">
            <a href="index.html" class="nav-item"><i class="fas fa-home"></i><span>Home</span></a>
            <a href="products.html" class="nav-item"><i class="fas fa-search"></i><span>Products</span></a>
            <a href="#" class="nav-item" id="mobileCartBtn">
                <div class="nav-item-wrapper">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="badge cart-count">0</span>
                </div>
                <span>Cart</span>
            </a>
            <a href="#" class="nav-item" id="mobileWishlistBtn">
                <div class="nav-item-wrapper">
                    <i class="fas fa-heart"></i>
                    <span class="badge wishlist-count">0</span>
                </div>
                <span>Wishlist</span>
            </a>
            <a href="account.html" class="nav-item"><i class="fas fa-user"></i><span>Account</span></a>
        </div>
    </div>

    <script src="js/main.js"></script>
    <script src="js/wishlist.js"></script>
    <script src="js/cart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            updateCartCount();
            updateWishlistCount();
            checkUserLogin();
            loadProductDetail();
            loadWishlistItems();
            
            // Wishlist Icon Click - Open sidebar instead of redirect
            document.getElementById('wishlistIcon').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('wishlistSidebar').classList.add('active');
                document.getElementById('wishlistOverlay').classList.add('active');
                loadWishlistItems();
            });

            // Mobile Wishlist Button Click
            document.getElementById('mobileWishlistBtn').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('wishlistSidebar').classList.add('active');
                document.getElementById('wishlistOverlay').classList.add('active');
                loadWishlistItems();
            });

            // Close wishlist when clicking overlay
            document.getElementById('wishlistOverlay').addEventListener('click', function() {
                document.getElementById('wishlistSidebar').classList.remove('active');
                this.classList.remove('active');
            });

            // Close wishlist with close button
            document.getElementById('closeWishlist').addEventListener('click', function() {
                document.getElementById('wishlistSidebar').classList.remove('active');
                document.getElementById('wishlistOverlay').classList.remove('active');
            });
            
            // Mobile cart button click
            document.getElementById('mobileCartBtn').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('cartSidebar').classList.add('active');
                document.getElementById('cartOverlay').classList.add('active');
            });

            // Cart Icon Click
            document.getElementById('cartIcon').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('cartSidebar').classList.add('active');
                document.getElementById('cartOverlay').classList.add('active');
            });

            // Close cart when clicking overlay
            document.getElementById('cartOverlay').addEventListener('click', function() {
                document.getElementById('cartSidebar').classList.remove('active');
                this.classList.remove('active');
            });

            // Close cart with close button
            document.getElementById('closeCart').addEventListener('click', function() {
                document.getElementById('cartSidebar').classList.remove('active');
                document.getElementById('cartOverlay').classList.remove('active');
            });

            // Update active state in bottom nav
            const currentPage = window.location.pathname.split('/').pop() || 'product-detail.html';
            document.querySelectorAll('.mobile-bottom-nav .nav-item').forEach(item => {
                const href = item.getAttribute('href');
                if (href === currentPage) {
                    item.classList.add('active');
                } else if (currentPage === '' && href === 'index.html') {
                    // For home page
                }
            });
            
            function getProductIdFromURL() {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get('id');
            }
            
            function loadProductDetail() {
                const productId = getProductIdFromURL();
                const container = document.getElementById('productDetailContent');
                const reviewsContainer = document.getElementById('reviewsSection');
                const relatedContainer = document.getElementById('relatedProductsSection');
                
                if (!productId) {
                    container.innerHTML = getProductNotFoundHTML();
                    return;
                }
                
                // Get all products
                let storeProducts = JSON.parse(localStorage.getItem('storeProducts')) || [];
                let warehouseProducts = JSON.parse(localStorage.getItem('warehouseProducts')) || [];
                const allProducts = [...storeProducts, ...warehouseProducts];
                const product = allProducts.find(p => String(p.id) === String(productId));
                
                if (!product) {
                    container.innerHTML = getProductNotFoundHTML();
                    return;
                }
                
                // Update breadcrumb
                document.getElementById('productCategory').textContent = product.category || 'General';
                document.getElementById('productName').textContent = product.name.substring(0, 30);
                
                // Render product details
                container.innerHTML = getProductDetailHTML(product, allProducts);
                
                // Load reviews
                loadReviews(productId, product);
                
                // Load related products
                loadRelatedProducts(product, allProducts);
                
                // Add event listeners
                addProductEventListeners(product);
            }
            
            function getProductDetailHTML(product, allProducts) {
                const storeName = product.store || product.shipperName || 'GlobalMart';
                const storeProductsCount = allProducts.filter(p => (p.store || p.shipperName || 'GlobalMart') === storeName).length;
                const originalPrice = product.originalPrice || (product.price * 1.2);
                const discount = ((originalPrice - product.price) / originalPrice * 100).toFixed(0);
                const rating = product.rating || (4 + Math.random()).toFixed(1);
                const ratingCount = Math.floor(Math.random() * 200) + 50;
                const priceInPKR = (product.price * 83 * 3.4).toFixed(0);
                const originalInPKR = (originalPrice * 83 * 3.4).toFixed(0);
                const isInWishlist = checkIfInWishlist(String(product.id));
                
                return `
                    <div class="product-detail">
                        <div class="product-images">
                            <div class="main-image-container">
                                <img src="${product.image}" alt="${product.name}" class="main-image" id="mainProductImage">
                            </div>
                            <div class="image-thumbnails">
                                <div class="thumbnail active" onclick="changeMainImage('${product.image}', this)">
                                    <img src="${product.image}" alt="thumbnail">
                                </div>
                                <div class="thumbnail" onclick="changeMainImage('https://via.placeholder.com/500x500?text=View+1', this)">
                                    <img src="https://via.placeholder.com/500x500?text=View+1" alt="thumbnail">
                                </div>
                                <div class="thumbnail" onclick="changeMainImage('https://via.placeholder.com/500x500?text=View+2', this)">
                                    <img src="https://via.placeholder.com/500x500?text=View+2" alt="thumbnail">
                                </div>
                                <div class="thumbnail" onclick="changeMainImage('https://via.placeholder.com/500x500?text=View+3', this)">
                                    <img src="https://via.placeholder.com/500x500?text=View+3" alt="thumbnail">
                                </div>
                                <div class="thumbnail" onclick="changeMainImage('https://via.placeholder.com/500x500?text=View+4', this)">
                                    <img src="https://via.placeholder.com/500x500?text=View+4" alt="thumbnail">
                                </div>
                            </div>
                        </div>
                        
                        <div class="product-info-detail">
                            <h1>${product.name}</h1>
                            
                            <div class="store-info">
                                <div class="store-avatar" onclick="viewStore('${storeName}')">
                                    <img src="https://ui-avatars.com/api/?name=${storeName.charAt(0)}&background=ff8c33&color=fff&size=128" alt="${storeName}">
                                </div>
                                <div class="store-details">
                                    <div class="store-name" onclick="viewStore('${storeName}')">
                                        ${storeName} <i class="fas fa-check-circle"></i>
                                    </div>
                                    <div class="store-meta">
                                        <span><i class="fas fa-box"></i> ${storeProductsCount} Products</span>
                                        <span><i class="fas fa-star" style="color: #faca51;"></i> 4.8 (1.2k+ ratings)</span>
                                        <span><i class="fas fa-clock"></i> ${product.fromWarehouse ? 'Warehouse' : 'Store'}</span>
                                    </div>
                                </div>
                                <button class="chat-btn" onclick="chatWithSeller()">
                                    <i class="fas fa-comment"></i> Chat
                                </button>
                            </div>
                            
                            <div class="product-rating">
                                <div class="rating-stars">
                                    ${generateStarIcons(parseFloat(rating))}
                                </div>
                                <span class="rating-score">${rating}</span>
                                <span class="rating-count">(${ratingCount} ratings)</span>
                                <span class="verified-badge">
                                    <i class="fas fa-shield-alt"></i> Verified
                                </span>
                            </div>
                            
                            <div class="product-price-detail">
                                <div class="current-price">
                                    Rs. ${priceInPKR}
                                    <span class="original-price">Rs. ${originalInPKR}</span>
                                    <span class="discount">-${discount}%</span>
                                </div>
                                <div class="tax-info">inclusive of all taxes</div>
                            </div>
                            
                            <div class="product-actions">
                                <div class="quantity-selector">
                                    <span class="quantity-label">Quantity:</span>
                                    <div class="quantity-controls">
                                        <button id="decreaseQty"><i class="fas fa-minus"></i></button>
                                        <input type="number" id="productQty" value="1" min="1" max="99">
                                        <button id="increaseQty"><i class="fas fa-plus"></i></button>
                                    </div>
                                </div>
                                
                                <div class="action-buttons">
                                    <button class="btn-cart" id="addToCartDetail">
                                        <i class="fas fa-shopping-cart"></i> Add to Cart
                                    </button>
                                    <button class="btn-buy" id="buyNowBtn">
                                        <i class="fas fa-bolt"></i> Buy Now
                                    </button>
                                    <button class="btn-wishlist ${isInWishlist ? 'active' : ''}" id="wishlistBtn">
                                        <i class="${isInWishlist ? 'fas' : 'far'} fa-heart"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="delivery-info">
                                <div class="delivery-item">
                                    <i class="fas fa-truck"></i>
                                    <div class="delivery-text">
                                        <div class="delivery-title">Free Delivery</div>
                                        <div class="delivery-desc">Free delivery on orders above Rs. 1,000</div>
                                    </div>
                                </div>
                                <div class="delivery-item">
                                    <i class="fas fa-undo-alt"></i>
                                    <div class="delivery-text">
                                        <div class="delivery-title">7 Days Return</div>
                                        <div class="delivery-desc">Change of mind is not applicable</div>
                                    </div>
                                </div>
                                <div class="delivery-item">
                                    <i class="fas fa-shield-alt"></i>
                                    <div class="delivery-text">
                                        <div class="delivery-title">Warranty</div>
                                        <div class="delivery-desc">${product.fromWarehouse ? '6 Months' : '1 Year'} Warranty</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="product-meta">
                                <div class="meta-row">
                                    <span class="meta-label">Category:</span>
                                    <span class="meta-value"><a href="products.html?category=${product.category}">${product.category || 'General'}</a></span>
                                </div>
                                <div class="meta-row">
                                    <span class="meta-label">Brand:</span>
                                    <span class="meta-value">Generic</span>
                                </div>
                                <div class="meta-row">
                                    <span class="meta-label">Availability:</span>
                                    <span class="meta-value stock-status">
                                        <i class="fas fa-check-circle"></i> In Stock (${Math.floor(Math.random() * 500) + 100} items)
                                    </span>
                                </div>
                                <div class="meta-row">
                                    <span class="meta-label">Shipping:</span>
                                    <span class="meta-value">Ships from ${product.fromWarehouse ? 'Warehouse' : 'Store'}</span>
                                </div>
                                <div class="meta-row">
                                    <span class="meta-label">Delivery:</span>
                                    <span class="meta-value">Estimated by ${getDeliveryDate()}</span>
                                </div>
                                <div class="meta-row">
                                    <span class="meta-label">SKU:</span>
                                    <span class="meta-value">GM${product.id}${Math.floor(Math.random() * 1000)}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            function loadReviews(productId, product) {
                const reviewsContainer = document.getElementById('reviewsSection');
                
                // Get existing reviews or create sample ones
                let reviews = getProductReviews(productId);
                
                // Calculate rating distribution
                const distribution = calculateRatingDistribution(reviews);
                const averageRating = reviews.length > 0 ? 
                    (reviews.reduce((sum, r) => sum + r.rating, 0) / reviews.length).toFixed(1) : "0.0";
                
                reviewsContainer.innerHTML = `
                    <div class="reviews-section">
                        <div class="reviews-header">
                            <h2>
                                Customer Reviews
                                <span>${reviews.length}</span>
                            </h2>
                            <button class="write-review-btn" onclick="toggleReviewForm()">
                                <i class="fas fa-pen"></i> Write a Review
                            </button>
                        </div>
                        
                        ${reviews.length > 0 ? `
                            <div class="rating-summary">
                                <div class="average-rating">
                                    <div class="big-rating">${averageRating}</div>
                                    <div class="rating-stars-large">
                                        ${generateStarIcons(parseFloat(averageRating))}
                                    </div>
                                    <div class="rating-total">${reviews.length} ratings</div>
                                </div>
                                <div class="rating-bars">
                                    ${generateRatingBars(distribution, reviews.length)}
                                </div>
                            </div>
                        ` : ''}
                        
                        <!-- Write Review Form -->
                        <div class="write-review-form" id="writeReviewForm">
                            <div class="form-header">
                                <h3>Write a Review</h3>
                                <button class="close-form" onclick="toggleReviewForm()">&times;</button>
                            </div>
                            
                            <div class="rating-input">
                                <label>Your Rating *</label>
                                <div class="star-rating-input" id="starRatingInput">
                                    <i class="far fa-star" data-rating="1"></i>
                                    <i class="far fa-star" data-rating="2"></i>
                                    <i class="far fa-star" data-rating="3"></i>
                                    <i class="far fa-star" data-rating="4"></i>
                                    <i class="far fa-star" data-rating="5"></i>
                                </div>
                                <input type="hidden" id="selectedRating" value="0">
                            </div>
                            
                            <div class="form-group">
                                <label>Review Title</label>
                                <input type="text" id="reviewTitle" placeholder="Summarize your experience">
                            </div>
                            
                            <div class="form-group">
                                <label>Review *</label>
                                <textarea id="reviewText" placeholder="Write your review here..."></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>Add Photos (Optional)</label>
                                <div class="image-upload" onclick="triggerFileUpload()">
                                    <i class="fas fa-camera"></i>
                                    <p>Click to upload photos</p>
                                    <input type="file" id="reviewImages" multiple accept="image/*" style="display: none;" onchange="handleImageUpload()">
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button class="btn-cancel" onclick="toggleReviewForm()">Cancel</button>
                                <button class="btn-submit" onclick="submitReview(${productId})">Submit Review</button>
                            </div>
                        </div>
                        
                        <!-- Reviews List -->
                        <div class="reviews-list" id="reviewsList">
                            ${reviews.length > 0 ? 
                                renderReviews(reviews.slice(0, 2)) : 
                                getNoReviewsHTML()
                            }
                        </div>
                        
                        ${reviews.length > 2 ? `
                            <div class="load-more">
                                <button class="load-more-btn" onclick="loadMoreReviews(${productId})">
                                    <i class="fas fa-spinner"></i> Load More (${reviews.length - 2})
                                </button>
                            </div>
                        ` : ''}
                    </div>
                `;
                
                // Add star rating listeners
                addStarRatingListeners();
            }
            
            function loadRelatedProducts(currentProduct, allProducts) {
                const relatedContainer = document.getElementById('relatedProductsSection');
                
                // Get products from same category or random
                let relatedProducts = allProducts
                    .filter(p => String(p.id) !== String(currentProduct.id) && 
                           (p.category === currentProduct.category))
                    .slice(0, 15); // Get more than needed for randomness
                
                // If not enough related products, add some random ones
                if (relatedProducts.length < 10) {
                    const otherProducts = allProducts
                        .filter(p => String(p.id) !== String(currentProduct.id) && p.category !== currentProduct.category)
                        .slice(0, 15 - relatedProducts.length);
                    relatedProducts = [...relatedProducts, ...otherProducts];
                }
                
                // Shuffle and take 10 random products
                relatedProducts = shuffleArray(relatedProducts).slice(0, 9);
                
                if (relatedProducts.length === 0) {
                    relatedContainer.innerHTML = '';
                    return;
                }
                
                let relatedHtml = `
                    <div class="related-products">
                        <div class="related-header">
                            <h2>
                                <i class="fas fa-magic"></i> You Might Also Like
                            </h2>
                            <button class="shuffle-btn" onclick="shuffleRelatedProducts('${currentProduct.id}')">
                                <i class="fas fa-random"></i> Shuffle
                            </button>
                        </div>
                        <div class="related-grid" id="relatedGrid">
                            ${renderRelatedProducts(relatedProducts)}
                        </div>
                    </div>
                `;
                
                relatedContainer.innerHTML = relatedHtml;
                
                // Add wishlist buttons to related products
                setTimeout(() => {
                    initializeWishlistButtons();
                }, 100);
            }
            
            function renderRelatedProducts(products) {
                return products.map(product => {
                    const storeName = product.store || product.shipperName || 'GlobalMart';
                    const rating = (3.5 + Math.random() * 1.5).toFixed(1);
                    const reviewCount = Math.floor(Math.random() * 50) + 10;
                    const hasDiscount = product.originalPrice && product.originalPrice > product.price;
                    const originalPrice = product.originalPrice || (product.price * 1.2);
                    const priceInPKR = (product.price * 83 * 3.4).toFixed(0);
                    const originalInPKR = (originalPrice * 83 * 3.4).toFixed(0);
                    const isInWishlist = checkIfInWishlist(String(product.id));
                    
                    return `
                        <div class="product-card">
                            <div class="product-image">
                                <img src="${product.image}" alt="${product.name}" 
                                     onerror="this.src='https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80'">
                                ${product.fromWarehouse ? '<div class="product-badge">Warehouse</div>' : ''}
                                <div class="product-wishlist" data-id="${product.id}">
                                    <i class="${isInWishlist ? 'fas' : 'far'} fa-heart"></i>
                                </div>
                            </div>
                            <div class="product-info">
                                <div class="product-category">${product.category || 'Electronics'}</div>
                                <h3 class="product-title">${product.name}</h3>
                                <p class="product-store"><i class="fas fa-store"></i> Sold by: ${storeName}</p>
                                <div class="product-rating">
                                    <div class="product-stars">
                                        ${generateStarIcons(parseFloat(rating))}
                                    </div>
                                    <span class="product-reviews">(${reviewCount} reviews)</span>
                                </div>
                                <p class="product-desc">${product.description || 'Premium quality product'}</p>
                                <div class="product-price">
                                    <span class="product-current">Rs. ${priceInPKR}</span>
                                    ${hasDiscount ? `<span class="product-original">Rs. ${originalInPKR}</span>` : ''}
                                </div>
                                ${product.commission ? `<div class="commission-badge">${product.commission}% Commission</div>` : ''}
                                <div class="product-buttons">
                                    <button class="btn-small add-to-cart" onclick="event.stopPropagation(); addRelatedToCart('${product.id}')">
                                        <i class="fas fa-shopping-cart"></i> Add
                                    </button>
                                    <a href="product-detail.html?id=${product.id}" class="btn-small view-details" onclick="event.stopPropagation();">
                                        <i class="fas fa-eye"></i> View
                                    </a>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }
            
            function getProductReviews(productId) {
                const allReviews = JSON.parse(localStorage.getItem('productReviews')) || [];
                let productReviews = allReviews.filter(r => String(r.productId) === String(productId));
                
                // If no reviews, generate 5 sample ones
                if (productReviews.length === 0) {
                    productReviews = generateSampleReviews(productId);
                    const updatedReviews = [...allReviews, ...productReviews];
                    localStorage.setItem('productReviews', JSON.stringify(updatedReviews));
                }
                
                return productReviews;
            }
            
            function generateSampleReviews(productId) {
                const names = ['Ahmed Khan', 'Fatima Ali', 'Bilal Ahmed', 'Sara Malik', 'Usman Chaudhry', 'Zainab Abbas', 'Hassan Raza', 'Ayesha Khan'];
                const titles = ['Excellent product!', 'Great value for money', 'Highly recommended', 'Good quality', 'Perfect!', 'Fast delivery', 'Happy with purchase', 'Amazing!'];
                const comments = [
                    'The product exceeded my expectations. Quality is superb and delivery was very fast. Highly recommended!',
                    'Great value for money. Works perfectly and the seller was very helpful with my questions.',
                    'Absolutely love this product! The quality is premium and it arrived in perfect condition.',
                    'Good product for the price. Shipping took a bit longer but worth the wait.',
                    'Excellent quality! Better than I expected. Will definitely buy again.',
                    'Very happy with my purchase. The product is exactly as described.',
                    'Great seller! Product quality is top notch. Fast shipping too.',
                    'Perfect product! The attention to detail is impressive.'
                ];
                
                const reviews = [];
                for (let i = 0; i < 8; i++) {
                    const randomIndex = Math.floor(Math.random() * names.length);
                    const rating = Math.floor(Math.random() * 2) + 4; // 4 or 5
                    
                    reviews.push({
                        id: Date.now() + i,
                        productId: productId,
                        name: names[randomIndex],
                        avatar: `https://ui-avatars.com/api/?name=${names[randomIndex].replace(' ', '+')}&background=ff8c33&color=fff&size=128`,
                        rating: rating,
                        title: titles[Math.floor(Math.random() * titles.length)],
                        comment: comments[Math.floor(Math.random() * comments.length)],
                        date: new Date(Date.now() - Math.random() * 90 * 24 * 60 * 60 * 1000).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }),
                        helpful: Math.floor(Math.random() * 20) + 1,
                        verified: Math.random() > 0.3
                    });
                }
                
                return reviews.sort((a, b) => b.rating - a.rating);
            }
            
            function renderReviews(reviews) {
                return reviews.map(review => `
                    <div class="review-item">
                        <div class="review-header">
                            <div class="reviewer-info">
                                <div class="reviewer-avatar">
                                    <img src="${review.avatar}" alt="${review.name}">
                                </div>
                                <div class="reviewer-details">
                                    <h4>
                                        ${review.name}
                                        ${review.verified ? '<i class="fas fa-check-circle" style="color: #1a9cb7; font-size: 12px;"></i>' : ''}
                                    </h4>
                                    <div class="stars">
                                        ${generateStarIcons(review.rating)}
                                    </div>
                                </div>
                            </div>
                            <div class="review-date">${review.date}</div>
                        </div>
                        <div class="review-content">
                            <h4>${review.title}</h4>
                            <p>${review.comment}</p>
                            ${review.images ? `
                                <div class="review-images">
                                    ${review.images.map(img => `
                                        <div class="review-image" onclick="viewImage('${img}')">
                                            <img src="${img}" alt="review image">
                                        </div>
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>
                        <div class="review-footer">
                            <button onclick="helpfulReview(${review.id})">
                                <i class="far fa-thumbs-up"></i> Helpful (${review.helpful})
                            </button>
                            <button onclick="reportReview(${review.id})">
                                <i class="far fa-flag"></i> Report
                            </button>
                        </div>
                    </div>
                `).join('');
            }
            
            function getNoReviewsHTML() {
                return `
                    <div class="no-reviews">
                        <i class="far fa-star"></i>
                        <p>No reviews yet. Be the first to review this product!</p>
                        <button class="write-review-btn" onclick="toggleReviewForm()">
                            <i class="fas fa-pen"></i> Write a Review
                        </button>
                    </div>
                `;
            }
            
            function calculateRatingDistribution(reviews) {
                const dist = [0, 0, 0, 0, 0];
                reviews.forEach(r => {
                    if (r.rating >= 1 && r.rating <= 5) {
                        dist[Math.floor(r.rating) - 1]++;
                    }
                });
                return dist;
            }
            
            function generateRatingBars(distribution, total) {
                let html = '';
                for (let i = 5; i >= 1; i--) {
                    const count = distribution[i - 1];
                    const percent = total > 0 ? (count / total * 100).toFixed(0) : 0;
                    html += `
                        <div class="rating-row">
                            <span class="stars">${i} <i class="fas fa-star"></i></span>
                            <div class="bar">
                                <div class="fill" style="width: ${percent}%"></div>
                            </div>
                            <span class="percent">${percent}%</span>
                        </div>
                    `;
                }
                return html;
            }
            
            function generateStarIcons(rating) {
                let stars = '';
                for (let i = 1; i <= 5; i++) {
                    if (i <= Math.floor(rating)) {
                        stars += '<i class="fas fa-star"></i>';
                    } else if (i - rating < 1 && i - rating > 0) {
                        stars += '<i class="fas fa-star-half-alt"></i>';
                    } else {
                        stars += '<i class="far fa-star"></i>';
                    }
                }
                return stars;
            }
            
            function addStarRatingListeners() {
                const stars = document.querySelectorAll('.star-rating-input i');
                const ratingInput = document.getElementById('selectedRating');
                
                if (!stars.length || !ratingInput) return;
                
                stars.forEach(star => {
                    star.addEventListener('mouseenter', function() {
                        const rating = parseInt(this.dataset.rating);
                        highlightStars(rating);
                    });
                    
                    star.addEventListener('mouseleave', function() {
                        const currentRating = parseInt(ratingInput.value);
                        highlightStars(currentRating);
                    });
                    
                    star.addEventListener('click', function() {
                        const rating = parseInt(this.dataset.rating);
                        ratingInput.value = rating;
                        highlightStars(rating);
                    });
                });
            }
            
            function highlightStars(rating) {
                const stars = document.querySelectorAll('.star-rating-input i');
                stars.forEach((star, index) => {
                    if (index < rating) {
                        star.className = 'fas fa-star';
                    } else {
                        star.className = 'far fa-star';
                    }
                });
            }
            
            function toggleReviewForm() {
                const form = document.getElementById('writeReviewForm');
                if (form) {
                    form.classList.toggle('show');
                    
                    // Reset form when opened
                    if (form.classList.contains('show')) {
                        document.getElementById('reviewTitle').value = '';
                        document.getElementById('reviewText').value = '';
                        document.getElementById('selectedRating').value = '0';
                        
                        const stars = document.querySelectorAll('.star-rating-input i');
                        stars.forEach(star => {
                            star.className = 'far fa-star';
                        });
                    }
                }
            }
            
            function submitReview(productId) {
                const rating = parseInt(document.getElementById('selectedRating').value);
                const title = document.getElementById('reviewTitle').value;
                const review = document.getElementById('reviewText').value;
                
                // Validation
                if (rating === 0) {
                    showNotification('Please select a rating');
                    return;
                }
                
                if (!review.trim()) {
                    showNotification('Please write a review');
                    return;
                }
                
                // Check if user is logged in
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                if (!currentUser) {
                    showNotification('Please login to submit a review');
                    setTimeout(() => {
                        window.location.href = 'account.html';
                    }, 2000);
                    return;
                }
                
                // Create new review
                const newReview = {
                    id: Date.now(),
                    productId: productId,
                    name: currentUser.name || 'User',
                    avatar: `https://ui-avatars.com/api/?name=${currentUser.name || 'User'}&background=ff8c33&color=fff`,
                    rating: rating,
                    title: title || 'Great product!',
                    comment: review,
                    date: new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }),
                    helpful: 0,
                    verified: true
                };
                
                // Save to localStorage
                let allReviews = JSON.parse(localStorage.getItem('productReviews')) || [];
                allReviews.push(newReview);
                localStorage.setItem('productReviews', JSON.stringify(allReviews));
                
                // Hide form
                toggleReviewForm();
                
                // Show success message
                showNotification('Thank you! Your review has been submitted.');
                
                // Reload reviews
                loadReviews(productId);
            }
            
            function addProductEventListeners(product) {
                // Quantity controls
                document.getElementById('decreaseQty').addEventListener('click', function() {
                    const qtyInput = document.getElementById('productQty');
                    let qty = parseInt(qtyInput.value);
                    if (qty > 1) qtyInput.value = qty - 1;
                });
                
                document.getElementById('increaseQty').addEventListener('click', function() {
                    const qtyInput = document.getElementById('productQty');
                    let qty = parseInt(qtyInput.value);
                    if (qty < 99) qtyInput.value = qty + 1;
                });
                
                // Add to cart
                document.getElementById('addToCartDetail').addEventListener('click', function() {
                    const qty = parseInt(document.getElementById('productQty').value);
                    const cartProduct = {...product, quantity: qty};
                    addToCart(cartProduct);
                    updateCartCount();
                    showToast(`${product.name} added to cart!`);
                });
                
                // Buy now
                document.getElementById('buyNowBtn').addEventListener('click', function() {
                    const qty = parseInt(document.getElementById('productQty').value);
                    localStorage.setItem('cart', JSON.stringify([{...product, quantity: qty}]));
                    updateCartCount();
                    showNotification('Redirecting to checkout...');
                    setTimeout(() => window.location.href = 'checkout.html', 1000);
                });
                
                // Wishlist
                document.getElementById('wishlistBtn').addEventListener('click', function() {
                    const productForWishlist = {
                        id: String(product.id),
                        name: product.name,
                        price: product.price,
                        image: product.image,
                        store: product.store || product.shipperName || 'GlobalMart',
                        category: product.category || 'General'
                    };
                    toggleWishlist(productForWishlist);
                    
                    // Update button state
                    const icon = this.querySelector('i');
                    const isInWishlist = checkIfInWishlist(String(product.id));
                    if (isInWishlist) {
                        this.classList.add('active');
                        icon.classList.remove('far');
                        icon.classList.add('fas');
                    } else {
                        this.classList.remove('active');
                        icon.classList.remove('fas');
                        icon.classList.add('far');
                    }
                });
            }
            
            function getDeliveryDate() {
                const date = new Date();
                date.setDate(date.getDate() + Math.floor(Math.random() * 5) + 3);
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            }
            
            function getProductNotFoundHTML() {
                return `
                    <div style="text-align: center; padding: 60px; background: white; border-radius: 12px;">
                        <i class="fas fa-exclamation-circle" style="font-size: 60px; color: #ff8c33; margin-bottom: 20px;"></i>
                        <h3 style="font-size: 24px; margin-bottom: 10px; color: #212121;">Product Not Found</h3>
                        <p style="color: #757575; margin-bottom: 25px;">The product you're looking for doesn't exist.</p>
                        <a href="products.html" class="btn btn-primary" style="padding: 12px 30px; background: #ff8c33; color: white; border-radius: 8px; text-decoration: none;">Browse Products</a>
                    </div>
                `;
            }
            
            function checkUserLogin() {
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                const dashboardLink = document.querySelector('.dashboard-link');
                if (currentUser) dashboardLink.style.display = 'block';
            }
            
            function showNotification(message) {
                const notification = document.createElement('div');
                notification.className = 'notification';
                notification.innerHTML = message;
                document.body.appendChild(notification);
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s';
                    setTimeout(() => document.body.removeChild(notification), 300);
                }, 3000);
            }
            
            // Global Functions
            window.changeMainImage = function(src, element) {
                document.getElementById('mainProductImage').src = src;
                document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
                element.classList.add('active');
            };
            
            window.viewStore = function(storeName) {
                window.location.href = `store.html?name=${encodeURIComponent(storeName)}`;
            };
            
            window.viewProduct = function(productId) {
                window.location.href = `product-detail.html?id=${productId}`;
            };
            
            window.chatWithSeller = function() {
                showNotification('Chat feature coming soon!');
            };
            
            window.helpfulReview = function(reviewId) {
                showNotification('Thank you for your feedback!');
            };
            
            window.reportReview = function(reviewId) {
                showNotification('Review reported. Thank you!');
            };
            
            window.toggleReviewForm = toggleReviewForm;
            
            window.triggerFileUpload = function() {
                document.getElementById('reviewImages').click();
            };
            
            window.handleImageUpload = function() {
                showNotification('Images uploaded successfully!');
            };
            
            window.viewImage = function(imageUrl) {
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0,0,0,0.9);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 10000;
                    cursor: pointer;
                `;
                modal.innerHTML = `
                    <img src="${imageUrl}" style="max-width: 90%; max-height: 90%; border-radius: 10px;">
                    <button style="position: absolute; top: 20px; right: 20px; background: white; border: none; width: 40px; height: 40px; border-radius: 50%; font-size: 20px; cursor: pointer;"></button>
                `;
                modal.onclick = function() {
                    document.body.removeChild(modal);
                };
                document.body.appendChild(modal);
            };
            
            window.loadMoreReviews = function(productId) {
                const reviews = getProductReviews(productId);
                const reviewsList = document.getElementById('reviewsList');
                const loadMoreBtn = document.querySelector('.load-more');
                
                if (reviews.length > 2) {
                    reviewsList.innerHTML = renderReviews(reviews);
                    if (loadMoreBtn) loadMoreBtn.style.display = 'none';
                    showNotification('All reviews loaded!');
                }
            };
            
            window.addRelatedToCart = function(productId) {
                let storeProducts = JSON.parse(localStorage.getItem('storeProducts')) || [];
                let warehouseProducts = JSON.parse(localStorage.getItem('warehouseProducts')) || [];
                const allProducts = [...storeProducts, ...warehouseProducts];
                const product = allProducts.find(p => String(p.id) === String(productId));
                
                if (product) {
                    const cartProduct = {...product, quantity: 1};
                    addToCart(cartProduct);
                    updateCartCount();
                    showToast(`${product.name} added to cart!`);
                }
            };
            
            window.shuffleRelatedProducts = function(currentProductId) {
                let storeProducts = JSON.parse(localStorage.getItem('storeProducts')) || [];
                let warehouseProducts = JSON.parse(localStorage.getItem('warehouseProducts')) || [];
                const allProducts = [...storeProducts, ...warehouseProducts];
                const currentProduct = allProducts.find(p => String(p.id) === String(currentProductId));
                
                if (currentProduct) {
                    loadRelatedProducts(currentProduct, allProducts);
                }
            };
        });

        // Wishlist Functions
        function checkIfInWishlist(productId) {
            const wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
            return wishlist.some(item => String(item.id) === String(productId));
        }

        function updateWishlistCount() {
            const wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
            const count = wishlist.length;
            document.querySelectorAll('.wishlist-count').forEach(el => {
                el.textContent = count;
                el.style.display = count > 0 ? 'inline-block' : 'none';
            });
        }

        function loadWishlistItems() {
            const wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
            const container = document.getElementById('wishlistItems');
            
            if (!container) return;
            
            if (wishlist.length === 0) {
                container.innerHTML = `
                    <div class="empty-wishlist">
                        <i class="fas fa-heart"></i>
                        <p>Your wishlist is empty</p>
                        <small>Click the heart icon on products to add them here</small>
                    </div>
                `;
                return;
            }
            
            let html = '';
            wishlist.forEach(item => {
                const priceInPKR = (item.price * 83 * 3.4).toFixed(0);
                html += `
                    <div class="wishlist-item" data-id="${item.id}">
                        <img src="${item.image}" alt="${item.name}" onerror="this.src='https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80'">
                        <div class="wishlist-item-info">
                            <h4 class="wishlist-item-title">${item.name}</h4>
                            <div class="wishlist-item-price">Rs. ${priceInPKR}</div>
                            <div class="wishlist-item-store">${item.store}</div>
                            <button class="wishlist-item-add-cart" onclick="addToCartFromWishlist('${item.id}')">
                                <i class="fas fa-shopping-cart"></i> Add to Cart
                            </button>
                        </div>
                        <button class="wishlist-item-remove" onclick="removeFromWishlist('${item.id}')">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function removeFromWishlist(productId) {
            let wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
            wishlist = wishlist.filter(item => String(item.id) !== String(productId));
            localStorage.setItem('wishlist', JSON.stringify(wishlist));
            
            // Update heart icons on all products
            document.querySelectorAll(`.product-wishlist[data-id="${productId}"] i`).forEach(heartIcon => {
                heartIcon.classList.remove('fas');
                heartIcon.classList.add('far');
            });
            
            // Update main wishlist button if on detail page
            const detailWishlistBtn = document.getElementById('wishlistBtn');
            if (detailWishlistBtn) {
                detailWishlistBtn.classList.remove('active');
                const icon = detailWishlistBtn.querySelector('i');
                if (icon) {
                    icon.classList.remove('fas');
                    icon.classList.add('far');
                }
            }
            
            updateWishlistCount();
            loadWishlistItems();
            showToast('Product removed from wishlist');
        }

        function addToCartFromWishlist(productId) {
            const wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
            const product = wishlist.find(item => String(item.id) === String(productId));
            
            if (!product) return;
            
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            const existing = cart.find(item => String(item.id) === String(product.id));
            
            if (existing) {
                existing.quantity = (existing.quantity || 1) + 1;
            } else {
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    image: product.image,
                    quantity: 1
                });
            }
            
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            showToast(`${product.name} added to cart`);
        }

        function toggleWishlist(product) {
            if (!product.id) return;
            
            const wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
            const existingIndex = wishlist.findIndex(item => String(item.id) === String(product.id));
            
            let message = '';
            
            if (existingIndex > -1) {
                wishlist.splice(existingIndex, 1);
                message = `${product.name} removed from wishlist`;
            } else {
                wishlist.push({
                    id: String(product.id),
                    name: product.name,
                    price: product.price || 0,
                    image: product.image || '',
                    category: product.category || 'General',
                    store: product.store || 'GlobalMart',
                    addedAt: new Date().toISOString()
                });
                message = `${product.name} added to wishlist`;
            }
            
            localStorage.setItem('wishlist', JSON.stringify(wishlist));
            
            // Update all heart icons with this product ID
            document.querySelectorAll(`.product-wishlist[data-id="${product.id}"] i`).forEach(heartIcon => {
                if (existingIndex > -1) {
                    heartIcon.classList.remove('fas');
                    heartIcon.classList.add('far');
                } else {
                    heartIcon.classList.remove('far');
                    heartIcon.classList.add('fas');
                }
            });
            
            // Update main wishlist button if on detail page
            const detailWishlistBtn = document.getElementById('wishlistBtn');
            if (detailWishlistBtn) {
                const icon = detailWishlistBtn.querySelector('i');
                if (existingIndex > -1) {
                    detailWishlistBtn.classList.remove('active');
                    if (icon) {
                        icon.classList.remove('fas');
                        icon.classList.add('far');
                    }
                } else {
                    detailWishlistBtn.classList.add('active');
                    if (icon) {
                        icon.classList.remove('far');
                        icon.classList.add('fas');
                    }
                }
            }
            
            updateWishlistCount();
            loadWishlistItems();
            showToast(message);
        }

        function handleWishlistClick(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const wishlistBtn = e.currentTarget;
            const productCard = wishlistBtn.closest('.product-card');
            
            if (!productCard) return;
            
            const productId = wishlistBtn.dataset.id;
            const productName = productCard.querySelector('.product-title')?.textContent || 'Product';
            const productPriceText = productCard.querySelector('.product-current')?.textContent || '0';
            const productPrice = parseFloat(productPriceText.replace('Rs', '').replace(/[.,]/g, '').trim()) / (83 * 3.4) || 0;
            const productImage = productCard.querySelector('img')?.src || '';
            const productStore = productCard.querySelector('.product-store')?.textContent.replace('Sold by:', '').trim() || 'GlobalMart';
            const productCategory = productCard.querySelector('.product-category')?.textContent || 'General';
            
            const product = {
                id: productId,
                name: productName,
                price: productPrice,
                image: productImage,
                store: productStore,
                category: productCategory
            };
            
            toggleWishlist(product);
        }

        function initializeWishlistButtons() {
            document.querySelectorAll('.product-wishlist').forEach(button => {
                button.removeEventListener('click', handleWishlistClick);
                button.addEventListener('click', handleWishlistClick);
            });
        }

        function showToast(message) {
            const existingToast = document.querySelector('.toast');
            if (existingToast) existingToast.remove();
            
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `
                <i class="fas ${message.includes('added') ? 'fa-heart' : 'fa-times'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const count = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
            document.querySelectorAll('.cart-count').forEach(el => el.textContent = count);
        }

        function addToCart(product) {
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            const existingItem = cart.find(item => String(item.id) === String(product.id));
            
            if (existingItem) {
                existingItem.quantity += product.quantity;
            } else {
                cart.push(product);
            }
            
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
        }

        // Initialize wishlist count on page load
        updateWishlistCount();
    </script>
</body>
</html>